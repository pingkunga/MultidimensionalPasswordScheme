var spotlight1;var doc=new GLGE.Document();var counter=0;doc.onLoad=function(){var m="true";localStorage.flag3D="true";localStorage.objNotActivate="true";spotlight1=doc.getElement("mainlight");var o=new GLGE.Renderer(document.getElementById("canvas"));if(typeof gameScene!="undefined"){console.log("Before");console.log(gameScene);console.log(gameScene)}gameScene=new GLGE.Scene();console.log("After");console.log(gameScene);gameScene=doc.getElement("mainscene");o.setScene(gameScene);var g=new GLGE.MouseInput(document.getElementById("canvas"));var h=new GLGE.KeyInput();var b=["ID39","ID45","ID51","ID57","ID63","ID16","ID28","ID72","ID85","ID95","ID103"];var f=["ID38","ID23","ID85","ID36","ID15","ID30","ID2","ID51"];var k=["ID347","ID281","ID301","ID760","ID766","ID14","ID22","ID28","ID34","ID40"];var r=["ID38","ID30","ID51"];var p=["ID23","ID36","ID15","ID2"];var n=["ID39","ID45","ID51","ID57","ID63","ID16","ID28","ID72","ID85","ID95","ID103"];var t=["ID347","ID281","ID301","ID760","ID766","ID14","ID22","ID28","ID34","ID40"];var e=false;function c(){if(e){var v=g.getMousePosition();v.x=v.x-document.getElementById("container").offsetLeft;v.y=v.y-document.getElementById("container").offsetTop;if(v.x&&v.y){if(typeof gameScene.pick(v.x,v.y).object!="null"){if(localStorage.CanvasOffset=="true"){obj=gameScene.pick(v.x,(v.y-100)).object}else{obj=gameScene.pick(v.x,v.y).object}if(obj.getId()!="wallobject"){function A(){var B=obj.getId();localStorage.requestFlag="true";console.log(B);localStorage.objid=B;console.log(jQuery.inArray(B,b));console.log(jQuery.inArray(B,f));console.log(jQuery.inArray(B,k));if(localStorage.objNotActivate=="true"){if(jQuery.inArray(B,b)!=-1){if(jQuery.inArray(B,n)!=-1){$("#txtPasswordDlg").on("dialogopen",function(D){$("#txtPasswordForm").remove();if(D.handled!==true){$.ajax({type:"POST",url:"../passwordType/textPassword.php/",data:{object:"computer"},success:function(E){$("#txtPasswordDlg").append(E)},async:true});D.handled=true}});$("#txtPasswordDlg").dialog("open");localStorage.Activate="computer";var C=">> Action: activate computer("+B+")&& Interaction: texual password <br/>";localStorage.flag3D="false";logDebug(C);writelog("computer","textual_password","click","prompt_dialog",C)}}else{if(jQuery.inArray(B,f)!=-1){if(jQuery.inArray(B,r)!=-1){if(localStorage.requestFlag="true"){$("#passPointDlg").on("dialogopen",function(D){$("#passPointDlg").load("../passwordType/passPoint.php",{object:"television"})});$("#passPointDlg").dialog("open");localStorage.Activate="television";var C=">> Action: activate television("+B+") && Interaction: graphical password(passpoint)<br/>";localStorage.flag3D="false";logDebug(C);writelog("television","graphical_password","click","prompt_dialog",C)}}else{if(jQuery.inArray(B,p)!=-1){if(localStorage.requestFlag="true"){$("#passPointDlg").on("dialogopen",function(D){$("#passPointDlg").load("../passwordType/passPoint.php",{object:"pictureOfSWU"})});$("#passPointDlg").dialog("open");localStorage.Activate="pictureOfSWU";var C=">> Action: activate picture of SWU("+B+") && Interaction: graphical password(passpoint)<br/>";localStorage.flag3D="false";logDebug(C);writelog("picture of SWU","graphical_password","click","prompt_dialog",C)}}}}else{if(jQuery.inArray(B,k)!=-1){if(jQuery.inArray(B,t)!=-1){if(localStorage.requestFlag="true"){$("#patternUnlockDlg").on("dialogopen",function(D){D.preventDefault();if(D.handled!==true){$("#patternUnlockDlg").load("../passwordType/patternUnlock.php",{object:"refrigerator"});D.handled=true}});$("#patternUnlockDlg").dialog("open");localStorage.Activate="refrigerator";var C=">> Action: activate refrigerator("+B+") && Interaction: graphical password(pattern unlock)<br/>";localStorage.flag3D="false";logDebug(C);writelog("refrigerator","graphical_password","click","prompt_dialog",C)}}}}}localStorage.objNotActivate="false"}}document.onmousedown=function(B){if(obj.getId()!="wallobject"){A()}}}}}var y=gameScene.camera;camerarot=y.getRotation();d=(v.y-(document.getElementById("canvas").offsetHeight/2))/500;var u=GLGE.mulMat4Vec4(y.getRotMatrix(),[0,0,-1,1]);var z=Math.pow(Math.pow(u[0],2)+Math.pow(u[1],2),0.5);u[0]=u[0]/z;u[1]=u[1]/z;y.setRotX(1.56-u[1]*d);y.setRotZ(-u[0]*d);var x=document.getElementById("canvas").offsetWidth;if(v.x<x*0.3){var w=Math.pow((v.x-x*0.3)/(x*0.3),2)*0.005*(a-i);y.setRotY(camerarot.y+w)}if(v.x>x*0.7){var w=Math.pow((v.x-x*0.7)/(x*0.3),2)*0.005*(a-i);y.setRotY(camerarot.y-w)}}}function j(){var x=gameScene.camera;camerapos=x.getPosition();camerarot=x.getRotation();var w=x.getRotMatrix();var v=GLGE.mulMat4Vec4(w,[0,0,-1,1]);var y=Math.pow(Math.pow(v[0],2)+Math.pow(v[1],2),0.5);v[0]=v[0]/y;v[1]=v[1]/y;var z=0;var u=0;if(h.isKeyPressed(GLGE.KI_W)){z=z+parseFloat(v[1]);u=u+parseFloat(v[0])}if(h.isKeyPressed(GLGE.KI_S)){z=z-parseFloat(v[1]);u=u-parseFloat(v[0])}if(h.isKeyPressed(GLGE.KI_A)){z=z+parseFloat(v[0]);u=u-parseFloat(v[1])}if(h.isKeyPressed(GLGE.KI_D)){z=z-parseFloat(v[0]);u=u+parseFloat(v[1])}if(h.isKeyPressed(GLGE.KI_LEFT_ARROW)){x.setRotZ(0.5)}if(levelmap.getHeightAt(camerapos.x+u,camerapos.y)>30){u=0}if(levelmap.getHeightAt(camerapos.x,camerapos.y+z)>30){z=0}if(levelmap.getHeightAt(camerapos.x+u,camerapos.y+z)>30){z=0;u=0}else{x.setLocZ(levelmap.getHeightAt(camerapos.x+u,camerapos.y+z)+8)}if(u!=0||z!=0){x.setLocY(camerapos.y+z*0.05*(a-i));x.setLocX(camerapos.x+u*0.05*(a-i))}}levelmap=new GLGE.HeightMap("../3Delement/3Dimg/map.png",120,120,-50,50,-50,50,0,50);var i=0;var s=60;start=parseInt(new Date().getTime());var a;var l=0;function q(){a=parseInt(new Date().getTime());s=Math.round(((s*9)+1000/(a-i))/10);$("#debug").html("Frame Rate:"+s);m=localStorage.flag3D;if(m=="true"){c();j()}o.render();i=a}setInterval(q,1);var d=0.2;document.getElementById("canvas").onmousedown=function(u){gameScene.pick(u.clientX-this.parentNode.offsetLeft,u.clientY-this.parentNode.offsetTop)};document.getElementById("canvas").onmouseover=function(u){e=true};document.getElementById("canvas").onmousemove=function(u){e=true};document.getElementById("canvas").onmouseout=function(u){e=false}};doc.load("../passwordType/level.xml");